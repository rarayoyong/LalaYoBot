from aiogram import F, Router
from aiogram.filters import CommandStart, Command
from aiogram.types import Message, CallbackQuery
from aiogram import types
from aiogram.fsm.context import FSMContext
from app.keyboards import create_categories_keyboard, create_exercises_keyboard, create_week_selection_keyboard, back_keyboard, menu
import app.keyboards as kb
import sqlite3

#—ç—Ç–æ –Ω–æ–≤–æ–µ
import re
from aiogram.utils.markdown import hlink

from app.motivsender import save_user 

router = Router()


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@router.message(CommandStart())
async def cmd_start(message: types.Message):
    chat_id = message.chat.id  # –ü–æ–ª—É—á–∞–µ–º chat_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    save_user(chat_id)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º chat_id –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

    photo_url = "https://disk.yandex.ru/i/Cy64rMGMHPYFrA.jpg"
    
    greeting_text = (
        f"üé∂ <b>–ü—Ä–∏–≤–µ—Ç, {message.from_user.first_name}!</b>\n\n"
        "–Ø <b>Lala Yo</b>, —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ –≤–æ–∫–∞–ª–∞! üé§\n"
        "–í–º–µ—Å—Ç–µ –º—ã –±—É–¥–µ–º —Ä–∞–∑–≤–∏–≤–∞—Ç—å —Ç–≤–æ–π –≥–æ–ª–æ—Å, —Ä–∞–∑–±–∏—Ä–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫—É.\n\n"
        "–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å? üòä"
    )

    await message.answer_photo(photo_url, caption=greeting_text, parse_mode="HTML")
    
    level_question = (
        "üåü <b>–û–ø—Ä–µ–¥–µ–ª–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å:</b>\n\n"
        "üîπ <b>–ù–æ–≤–∏—á–æ–∫</b> ‚Äì –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å –∏ —Ö–æ—á–µ—à—å –∏–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤—ã.\n"
        "üîπ <b>–û–ø—ã—Ç–Ω—ã–π</b> ‚Äì –µ—Å–ª–∏ —É–∂–µ —É–º–µ–µ—à—å –ø–µ—Ç—å, –Ω–æ —Ö–æ—á–µ—à—å —É–ª—É—á—à–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É.\n\n"
        "üëâ –ù–∞–ø–∏—à–∏ –≤ —á–∞—Ç —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å, –∏ —è –ø–æ–¥–±–µ—Ä—É –¥–ª—è —Ç–µ–±—è –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è!"
    )

    await message.answer(level_question, parse_mode="HTML", reply_markup=kb.menu)


# üéØ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
@router.message(Command("help"))
async def cmd_help(message: types.Message):
    help_text = (
        "üîπ <b>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:</b>\n\n"
        "üìå <b>/start</b> ‚Äì –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "üìå <b>/help</b> ‚Äì –ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º\n"
        "üìå <b>–®–ø–∞—Ä–≥–∞–ª–∫–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞</b> ‚Äì –ü–ª–∞–Ω –∑–∞–Ω—è—Ç–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö\n"
        "üìå <b>–°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</b> ‚Äì –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è\n"
        "üìå <b>–°–æ–≤–µ—Ç—ã –ø–æ –≤–æ–∫–∞–ª—É</b> ‚Äì –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
        "üìå <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ–ª–æ—Å–µ</b> ‚Äì –£–∑–Ω–∞–π —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å\n\n"
        "‚ú® –ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –µ—ë –≤ —á–∞—Ç!"
    )
    await message.answer(help_text, parse_mode="HTML")

# üé§ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–°–æ–≤–µ—Ç—ã –ø–æ –≤–æ–∫–∞–ª—É"
@router.message(lambda message: message.text == "–°–æ–≤–µ—Ç—ã –ø–æ –≤–æ–∫–∞–ª—É")
async def handle_vocal_tips(message: types.Message):
    tips_text = (
        "üé∂ <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –≤–æ–∫–∞–ª–∏—Å—Ç–æ–≤:</b>\n\n"
        "1Ô∏è‚É£ <b>–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ</b> ‚Äì –î—ã—à–∏—Ç–µ –∂–∏–≤–æ—Ç–æ–º, –∞ –Ω–µ –≥—Ä—É–¥—å—é. –î–∏–∞—Ñ—Ä–∞–≥–º–∞–ª—å–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ –¥–∞—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≥–æ–ª–æ—Å–æ–º –∏ —É–ª—É—á—à–∞–µ—Ç –∑–≤—É–∫.\n\n"
        "2Ô∏è‚É£ <b>–†–∞–∑–æ–≥—Ä–µ–≤ –ø–µ—Ä–µ–¥ –ø–µ–Ω–∏–µ–º</b> ‚Äì –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–∫–∞–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: –≥—É–¥–µ–Ω–∏–µ (–º–º–º...), –ª–µ–≥–∫–∏–µ —Ä–∞—Å–ø–µ–≤–∫–∏, –≥—É–±–Ω—ã–µ —Ç—Ä–µ–ª–∏. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–≤—è–∑–∫–∞–º —Ä–∞–∑–æ–≥—Ä–µ—Ç—å—Å—è –∏ –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\n"
        "3Ô∏è‚É£ <b>–ì–∏–¥—Ä–∞—Ç–∞—Ü–∏—è</b> ‚Äì –ü–µ–π—Ç–µ —Ç—ë–ø–ª—É—é –≤–æ–¥—É –∏–ª–∏ —Ç—Ä–∞–≤—è–Ω—ã–µ —á–∞–∏. –ò–∑–±–µ–≥–∞–π—Ç–µ —Ö–æ–ª–æ–¥–Ω—ã—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤ –∏ –∫–æ—Ñ–µ–∏–Ω–∞ –ø–µ—Ä–µ–¥ –ø–µ–Ω–∏–µ–º ‚Äì –æ–Ω–∏ —Å—É—à–∞—Ç —Å–≤—è–∑–∫–∏.\n\n"
        "4Ô∏è‚É£ <b>–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ —Å–µ–±—è</b> ‚Äì –°–ª—É—à–∞–π—Ç–µ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏, –æ—Ç–º–µ—á–∞–π—Ç–µ –æ—à–∏–±–∫–∏, —Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –∏–Ω—Ç–æ–Ω–∞—Ü–∏–µ–π –∏ –¥–∏–∫—Ü–∏–µ–π. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ.\n\n"
        "5Ô∏è‚É£ <b>–≠–º–æ—Ü–∏–∏ –≤ –≥–æ–ª–æ—Å–µ</b> ‚Äì –ü–æ–π—Ç–µ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º! –ì–æ–ª–æ—Å –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏ ‚Äì —Ä–∞–¥–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç–µ –∏—Å—Ç–æ—Ä–∏—é!\n\n"
        "6Ô∏è‚É£ <b>–û—Å–Ω–æ–≤–∞ —Ö–æ—Ä–æ—à–µ–≥–æ –∑–≤—É–∫–∞</b> ‚Äì –ù–µ —Å–∂–∏–º–∞–π—Ç–µ –≥–æ—Ä–ª–æ! –†–∞—Å—Å–ª–∞–±—å—Ç–µ –º—ã—à—Ü—ã –ª–∏—Ü–∞, —à–µ–∏ –∏ –ø–ª–µ—á, –ø–æ–π—Ç–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.\n\n"
        "7Ô∏è‚É£ <b>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ—Å–∞–Ω–∫–æ–π</b> ‚Äì –í—ã–ø—Ä—è–º–∏—Ç–µ —Å–ø–∏–Ω—É, —Å–ª–µ–≥–∫–∞ –æ–ø—É—Å—Ç–∏—Ç–µ –ø–ª–µ—á–∏. –•–æ—Ä–æ—à–∞—è –æ—Å–∞–Ω–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ª—É—á—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥—ã—Ö–∞–Ω–∏–µ.\n\n"
        "8Ô∏è‚É£ <b>–ü–æ–π—Ç–µ —Å —É–¥–æ–±–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º</b> ‚Äì –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Å—Ä–∞–∑—É –±—Ä–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –≤—ã—Å–æ–∫–∏–µ –Ω–æ—Ç—ã. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω, —Ä–∞–∑–≤–∏–≤–∞—è –≥–∏–±–∫–æ—Å—Ç—å –≥–æ–ª–æ—Å–∞.\n\n"
        "9Ô∏è‚É£ <b>–¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ—Å—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ</b> ‚Äì –õ—É—á—à–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è 15‚Äì30 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á–µ–º 2 —á–∞—Å–∞ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.\n\n"
        "üîü <b>–û—Ç–¥—ã—Ö–∞–π—Ç–µ!</b> ‚Äì –ù–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä—è–≥–∞–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–≤—è–∑–∫–∏. –ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏–ª–∏ –æ—Ö—Ä–∏–ø–ª–æ—Å—Ç—å, –¥–∞–π—Ç–µ –≥–æ–ª–æ—Å—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.\n\n"
        "üé§ –ì–ª–∞–≤–Ω–æ–µ ‚Äì –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –æ—Ç –ø–µ–Ω–∏—è! –£–¥–∞—á–∏! üòä"
    )
    await message.answer(tips_text, parse_mode="HTML")

# üó£ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ–ª–æ—Å–µ"
@router.message(lambda message: message.text == "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ–ª–æ—Å–µ")
async def handle_voice_info(message: types.Message):
    voice_info_text = (
        "üßê <b>–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –≥–æ–ª–æ—Å–µ:</b>\n\n"
        "üîπ <b>–ì–æ–ª–æ—Å ‚Äì —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ —Å–≤—è–∑–∫–∏!</b> üó£Ô∏è –û–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞ —Å—á—ë—Ç —Ä–∞–±–æ—Ç—ã –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–≤—è–∑–æ–∫, —Ä–µ–∑–æ–Ω–∞—Ç–æ—Ä–æ–≤ (—Ä–æ—Ç, –Ω–æ—Å, –≥—Ä—É–¥—å) –∏ –¥—ã—Ö–∞–Ω–∏—è.\n\n"
        "üîπ <b>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç üéµ</b> ‚Äì –ì–æ–ª–æ—Å –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º, –∫–∞–∫ –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –ø–∞–ª—å—Ü–∞. –î–∞–∂–µ —É –±–ª–∏–∑–Ω–µ—Ü–æ–≤ –µ—Å—Ç—å —Ä–∞–∑–ª–∏—á–∏—è –≤ —Ç–µ–º–±—Ä–µ!\n\n"
        "üîπ <b>–†–∞–∑–≤–∏—Ç–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞</b> üî• ‚Äì –ï—Å–ª–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Å–≤–æ–π –≤–æ–∫–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ—Ç, –∞ –∏–Ω–æ–≥–¥–∞ –∏ –Ω–∞ —Ü–µ–ª—É—é –æ–∫—Ç–∞–≤—É!\n\n"
        "üîπ <b>–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–≤—è–∑–∫–∏ ‚Äì —ç—Ç–æ –º—ã—à—Ü—ã üí™</b> ‚Äì –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –º—ã—à—Ü—ã, –ø–æ—ç—Ç–æ–º—É –∏—Ö –º–æ–∂–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å, —É–∫—Ä–µ–ø–ª—è—Ç—å –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å.\n\n"
        "üîπ <b>–í—ã—Å–æ–∫–∏–µ –∏ –Ω–∏–∑–∫–∏–µ –Ω–æ—Ç—ã</b> üé∂ ‚Äì –ó–∞ –Ω–∏—Ö –æ—Ç–≤–µ—á–∞—é—Ç –¥–ª–∏–Ω–∞ –∏ –Ω–∞—Ç—è–∂–µ–Ω–∏–µ —Å–≤—è–∑–æ–∫. –ß–µ–º –∫–æ—Ä–æ—á–µ –∏ –Ω–∞—Ç—è–Ω—É—Ç–µ–µ —Å–≤—è–∑–∫–∏, —Ç–µ–º –≤—ã—à–µ –∑–≤—É–∫, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.\n\n"
        "üîπ <b>–ì—Ä—É–¥–Ω–æ–π –∏ –≥–æ–ª–æ–≤–Ω–æ–π —Ä–µ–∑–æ–Ω–∞–Ω—Å</b> üèÜ ‚Äì –ì—Ä—É–¥–Ω—ã–µ –∑–≤—É–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞ —Å—á—ë—Ç –≤–∏–±—Ä–∞—Ü–∏–∏ –≤ –≥—Ä—É–¥–∏, –∞ –≥–æ–ª–æ–≤–Ω—ã–µ ‚Äì –≤ –æ–±–ª–∞—Å—Ç–∏ –≥–æ–ª–æ–≤—ã –∏ –Ω–æ—Å–æ–≤—ã—Ö –ø–∞–∑—É—Ö.\n\n"
        "üîπ <b>–£–º–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç—å ‚Äì –Ω–µ —Ä–∞–≤–Ω–æ —É–º–µ–Ω–∏—é –ø–µ—Ç—å! üé§</b> ‚Äì –†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π –≥–æ–ª–æ—Å –∏ –ø–µ–≤—á–µ—Å–∫–∏–π –≥–æ–ª–æ—Å —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É. –ü–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –¥—ã—Ö–∞–Ω–∏—è, —Ç–µ—Ö–Ω–∏–∫–∏ –∏ —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞.\n\n"
        "üîπ <b>–°–≤—è–∑–∫–∏ –º–æ–≥—É—Ç –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–æ 1 000 000 –≤–∏–±—Ä–∞—Ü–∏–π –≤ –¥–µ–Ω—å! üò≤</b> ‚Äì –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ –¥–∞–≤–∞—Ç—å –∏–º –æ—Ç–¥—ã—Ö –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –≥–æ–ª–æ—Å–µ.\n\n"
        "üîπ <b>–í–æ–∫–∞–ª —É–ª—É—á—à–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ ü©∫</b> ‚Äì –ü–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –ª—ë–≥–∫–∏–µ, —É–ª—É—á—à–∞–µ—Ç –æ—Å–∞–Ω–∫—É –∏ –¥–∞–∂–µ —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å!\n\n"
        "üé§ <b>–í—ã–≤–æ–¥:</b> –ì–æ–ª–æ—Å ‚Äì —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å, –∫–∞–∫ –∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –Ω–∞–≤—ã–∫. –ì–ª–∞–≤–Ω–æ–µ ‚Äì –ø—Ä–∞–∫—Ç–∏–∫–∞ –∏ –ª—é–±–æ–≤—å –∫ –ø–µ–Ω–∏—é! ‚ù§Ô∏è"
    )
    await message.answer(voice_info_text, parse_mode="HTML")

# üéØ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤–æ–∫–∞–ª–∞
@router.message(lambda message: message.text.lower() in ["–Ω–æ–≤–∏—á–æ–∫", "–æ–ø—ã—Ç–Ω—ã–π"])
async def handle_level(message: types.Message):
    user_input = message.text.lower()
    if "–Ω–æ–≤–∏—á–æ–∫" in user_input:
        await message.answer(
            "üéâ –û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω—ë–º —Å –∞–∑–æ–≤. –í–æ—Ç –ø–ª–∞–Ω –∑–∞–Ω—è—Ç–∏–π –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤:",
            parse_mode="HTML",
            reply_markup=kb.menu
        )
        await handle_cheat_sheet(message)
    elif "–æ–ø—ã—Ç–Ω—ã–π" in user_input:
        await message.answer(
            "üöÄ –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –í–∞–º –ø–æ–¥–æ–π–¥—É—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:",
            parse_mode="HTML",
            reply_markup=kb.menu
        )
        await handle_exercises_list(message)

# üìú –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ö–æ–º–∞–Ω–¥—ã –¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞"
@router.message(lambda message: message.text == "–ö–æ–º–∞–Ω–¥—ã –¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞")
async def handle_commands(message: types.Message):
    commands_text = (
        "üìú <b>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:</b>\n\n"
        "üü¢ <b>/start</b> ‚Äì –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "üü¢ <b>/help</b> ‚Äì –ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É\n"
        "üü¢ <b>–®–ø–∞—Ä–≥–∞–ª–∫–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞</b> ‚Äì –£–∑–Ω–∞—Ç—å –æ –±–∞–∑–æ–≤—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ö\n"
        "üü¢ <b>–°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</b> ‚Äì –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è\n"
        "üü¢ <b>–°–æ–≤–µ—Ç—ã –ø–æ –≤–æ–∫–∞–ª—É</b> ‚Äì –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
        "üü¢ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ–ª–æ—Å–µ</b> ‚Äì –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –≥–æ–ª–æ—Å–µ\n\n"
        "üé∂ –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –æ–±—É—á–µ–Ω–∏–µ–º!"
    )
    await message.answer(commands_text, parse_mode="HTML")


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–®–ø–∞—Ä–≥–∞–ª–∫–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞"
@router.message(lambda message: message.text == "–®–ø–∞—Ä–≥–∞–ª–∫–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞")
async def handle_cheat_sheet(message: types.Message):    

    explanation = (
        "üìö <b>–ü–ª–∞–Ω –∑–∞–Ω—è—Ç–∏–π –Ω–∞ –º–µ—Å—è—Ü</b>\n\n"
        "–≠—Ç–æ—Ç –ø–ª–∞–Ω –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞–∑–≤–∏—Ç—å –≥–æ–ª–æ—Å, —É–ª—É—á—à–∏—Ç—å –¥—ã—Ö–∞–Ω–∏–µ –∏ –¥–∏–∫—Ü–∏—é.\n"
        "–ö–∞–∂–¥–∞—è –Ω–µ–¥–µ–ª—è –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –Ω–µ–¥–µ–ª—é –∏ —Å–ª–µ–¥—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º!"
    )

    await message.answer(explanation, parse_mode="HTML")

    await message.answer(
        "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é:", 
        parse_mode="HTML",
        reply_markup=create_week_selection_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –Ω–µ–¥–µ–ª–∏
@router.callback_query(lambda c: c.data.startswith("week_"))
async def process_week_callback(callback_query: CallbackQuery):

    week_data = {
        "week_1": (
            "üìå <b>–ù–µ–¥–µ–ª—è 1: –î—ã—Ö–∞–Ω–∏–µ –∏ –æ—Å–Ω–æ–≤—ã –∑–≤—É–∫–æ–∏–∑–≤–ª–µ—á–µ–Ω–∏—è</b>\n\n"
            "1Ô∏è‚É£ <b>–í–æ–∑–¥—É—à–Ω—ã–π —à–∞—Ä</b> üéà ‚Äì –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –≤ –∂–∏–≤–æ—Ç–µ –≤–æ–∑–¥—É—à–Ω—ã–π —à–∞—Ä. –í–¥–æ—Ö–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –Ω–æ—Å, –Ω–∞–ø–æ–ª–Ω—è—è –∂–∏–≤–æ—Ç, –∞ –∑–∞—Ç–µ–º –º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥–æ—Ö–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ —Ä–æ—Ç.\n\n"
            "2Ô∏è‚É£ <b>–°–≤–µ—á–∞</b> üïØ ‚Äì –≤–¥–æ—Ö–Ω–∏—Ç–µ –∏ –≤—ã–¥—ã—Ö–∞–π—Ç–µ —Ç–∞–∫, —á—Ç–æ–±—ã –ø–ª–∞–º—è —Å–≤–µ—á–∏ –∫–æ–ª–µ–±–∞–ª–æ—Å—å, –Ω–æ –Ω–µ –≥–∞—Å–ª–æ. –≠—Ç–æ –Ω–∞—É—á–∏—Ç –≤–∞—Å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥—ã—Ö–∞–Ω–∏–µ.\n\n"
            "3Ô∏è‚É£ <b>–®–∏–ø—è—â–µ–µ –¥—ã—Ö–∞–Ω–∏–µ</b> üêç ‚Äì —Å–¥–µ–ª–∞–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–π –≤—ã–¥–æ—Ö —Å–æ –∑–≤—É–∫–æ–º '—Å—Å—Å—Å', –∫–∞–∫ –∑–º–µ—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ.\n\n"
            "4Ô∏è‚É£ <b>–ì—É–¥–µ–Ω–∏–µ</b> üéµ ‚Äì –∑–∞–∫—Ä–æ–π—Ç–µ —Ä–æ—Ç –∏ —Ç—è–Ω–∏—Ç–µ '–º–º–º', –æ—â—É—â–∞—è –≤–∏–±—Ä–∞—Ü–∏—é –≤ –≥—É–±–∞—Ö. –≠—Ç–æ —Ä–∞–∑–æ–≥—Ä–µ–µ—Ç –≥–æ–ª–æ—Å.\n\n"
            "5Ô∏è‚É£ <b>–õ–µ–Ω–∏–≤—ã–µ –∑–≤—É–∫–∏</b> üó£ ‚Äì —Ç—è–Ω–∏—Ç–µ '–ê-–∞-–∞', '–û-–æ-–æ', '–£-—É-—É', —Ä–∞—Å—Å–ª–∞–±–ª—è—è –≥–æ—Ä–ª–æ.\n\n"
            "6Ô∏è‚É£ <b>–î—ã—Ö–∞–Ω–∏–µ 4-4-4</b> üå¨ ‚Äì –≤–¥–æ—Ö–Ω–∏—Ç–µ –Ω–∞ 4 —Å—á—ë—Ç–∞, –∑–∞–¥–µ—Ä–∂–∏—Ç–µ –¥—ã—Ö–∞–Ω–∏–µ –Ω–∞ 4 —Å—á—ë—Ç–∞, –º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥–æ—Ö–Ω–∏—Ç–µ –Ω–∞ 4 —Å—á—ë—Ç–∞.\n\n"
            "7Ô∏è‚É£ <b>–®—ë–ø–æ—Ç</b> ü§´ ‚Äì –ø—Ä–æ—à–µ–ø—á–∏—Ç–µ –¥–ª–∏–Ω–Ω—É—é —Ñ—Ä–∞–∑—É, –Ω–µ –Ω–∞–ø—Ä—è–≥–∞—è –≥–æ—Ä–ª–æ.\n\n"
            "8Ô∏è‚É£ <b>–ö–∞—á–µ–ª–∏</b> üé¢ ‚Äì –ø–æ–π—Ç–µ '—É-–∞' –∏–ª–∏ '–æ-–∏', –º–µ–Ω—è—è –≤—ã—Å–æ—Ç—É –∑–≤—É–∫–∞ –ø–ª–∞–≤–Ω–æ.\n\n"
            "9Ô∏è‚É£ <b>–ú—è–≥–∫–æ–µ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ</b> ‚òÅ ‚Äì –≥–æ–≤–æ—Ä–∏—Ç–µ –≥–ª–∞—Å–Ω—ã–µ –∑–≤—É–∫–∏ –ø–ª–∞–≤–Ω–æ –∏ –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –∞—Ç–∞–∫.\n\n"
            "üîü <b>–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ</b> üõÄ ‚Äì –ø–µ—Ä–µ–¥ –∑–∞–Ω—è—Ç–∏–µ–º —Ä–∞—Å—Å–ª–∞–±—å—Ç–µ –ª–∏—Ü–æ, —à–µ—é –∏ –ø–ª–µ—á–∏, –ø–æ–∫—Ä—É—Ç–∏—Ç–µ –≥–æ–ª–æ–≤–æ–π –∏ —Ä–∞–∑–æ–º–Ω–∏—Ç–µ —á–µ–ª—é—Å—Ç—å.\n"
        ),

        "week_2": (
            "üìå <b>–ù–µ–¥–µ–ª—è 2: –†–∞–∑–≤–∏—Ç–∏–µ –≥–æ–ª–æ—Å–∞</b>\n\n"
            "1Ô∏è‚É£ <b>–ë–∞–±–æ—á–∫–∞</b> ü¶ã ‚Äì –≥—É–±—ã –≤ —Ç—Ä—É–±–æ—á–∫—É, –ø—Ä–æ–∏–∑–Ω–µ—Å–∏—Ç–µ '–±–±—Ä—Ä—Ä', —á—Ç–æ–±—ã –æ–Ω–∏ –∑–∞–≤–∏–±—Ä–∏—Ä–æ–≤–∞–ª–∏.\n\n"
            "2Ô∏è‚É£ <b>–ñ—É–∂–∂–∞–Ω–∏–µ</b> üêù ‚Äì —Å–∫–∞–∂–∏—Ç–µ '–∑–∑–∑' –∏–ª–∏ '–≤–≤–≤', —á—É–≤—Å—Ç–≤—É—è –≤–∏–±—Ä–∞—Ü–∏—é –≤ –ª–∏—Ü–µ.\n\n"
            "3Ô∏è‚É£ <b>–¢—è–Ω–µ–º —Ä–µ–∑–∏–Ω—É</b> üé∂ ‚Äì –ø–æ–π—Ç–µ '–ú–∞-–ú–æ-–ú—É-–ú–∏-–ú—ç', –ø–ª–∞–≤–Ω–æ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—è –∑–≤—É–∫–∏.\n\n"
            "4Ô∏è‚É£ <b>–ù–∞–ø–µ–≤–∞–Ω–∏–µ</b> üéº ‚Äì –Ω–∞–ø–µ–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é –º–µ–ª–æ–¥–∏—é –Ω–∞ '–ª—è-–ª—è-–ª—è'.\n\n"
            "5Ô∏è‚É£ <b>–ü–µ–Ω–∏–µ –±–µ–∑ —Å–ª–æ–≤</b> üé§ ‚Äì –ø–æ–π—Ç–µ –º–µ–ª–æ–¥–∏–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞—Å–Ω—ã–µ '–ê-–û-–£-–ò-–≠'.\n\n"
            "6Ô∏è‚É£ <b>–ö–∞—à–µ–ª—å —Å –≥–æ–ª–æ—Å–æ–º</b> ü§ß ‚Äì –ª–µ–≥–∫–æ –ø–æ–∫–∞—à–ª—è–π—Ç–µ —Å –≥–æ–ª–æ—Å–æ–º, –æ—â—É—â–∞—è –≤–∏–±—Ä–∞—Ü–∏—é –≤ –≥—Ä—É–¥–∏.\n\n"
            "7Ô∏è‚É£ <b>–í–æ—Ä—á–∞–Ω–∏–µ</b> ü¶Å ‚Äì –º—è–≥–∫–æ –≤–æ—Ä—á–∏—Ç–µ, —á—É–≤—Å—Ç–≤—É—è –≤–∏–±—Ä–∞—Ü–∏—é –≤ –≥—Ä—É–¥–∏.\n\n"
            "8Ô∏è‚É£ <b>–°–∫–æ–ª—å–∑—è—â–∏–µ –∑–≤—É–∫–∏</b> üèÑ‚Äç‚ôÇÔ∏è ‚Äì —Ç—è–Ω–∏—Ç–µ '—É-—É-—É' –∏–ª–∏ '–∏-–∏-–∏', –ø–ª–∞–≤–Ω–æ –º–µ–Ω—è—è –≤—ã—Å–æ—Ç—É –∑–≤—É–∫–∞.\n\n"
            "9Ô∏è‚É£ <b>–ì–æ–≤–æ—Ä–∏–º –Ω–∞ —Ä–∞–∑–Ω–æ–π –≤—ã—Å–æ—Ç–µ</b> üì£ ‚Äì –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç–µ —Ñ—Ä–∞–∑—ã —Å–Ω–∞—á–∞–ª–∞ –Ω–∏–∑–∫–∏–º, –ø–æ—Ç–æ–º –≤—ã—Å–æ–∫–∏–º –≥–æ–ª–æ—Å–æ–º.\n\n"
            "üîü <b>–ó–≤—É–∫–æ–≤–æ–π –º–∞—Å—Å–∞–∂</b> üíÜ ‚Äì –ø–æ–π—Ç–µ '–º-–º-–º', –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞—è –ø–∞–ª—å—Ü—ã –∫ —â–µ–∫–∞–º, —á—Ç–æ–±—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∏–±—Ä–∞—Ü–∏—é.\n"
        ),

        "week_3": (
            "üìå <b>–ù–µ–¥–µ–ª—è 3: –ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏—è –∏ –¥–∏–∫—Ü–∏—è</b>\n\n"
            "1Ô∏è‚É£ <b>–°–∫–æ—Ä–æ–≥–æ–≤–æ—Ä–∫–∏</b> üèÉ‚Äç‚ôÇÔ∏è ‚Äì –ø—Ä–æ–≥–æ–≤–∞—Ä–∏–≤–∞–π—Ç–µ –º–µ–¥–ª–µ–Ω–Ω–æ, –∑–∞—Ç–µ–º —É—Å–∫–æ—Ä—è–π—Ç–µ—Å—å.\n\n"
            "2Ô∏è‚É£ <b>–ö–∞—Ä–∞–Ω–¥–∞—à –≤–æ —Ä—Ç—É</b> ‚úè ‚Äì –∑–∞–∂–º–∏—Ç–µ –∫–∞—Ä–∞–Ω–¥–∞—à –∑—É–±–∞–º–∏ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ —Ñ—Ä–∞–∑—ã.\n\n"
            "3Ô∏è‚É£ <b>–ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ –≥–ª–∞—Å–Ω—ã—Ö</b> üîÑ ‚Äì –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç–µ '–ê-–û-–£-–ò-–≠' –≤ —Ä–∞–∑–Ω–æ–º —Ç–µ–º–ø–µ.\n\n"
            "4Ô∏è‚É£ <b>–†–∞–∑–º–∏–Ω–∫–∞ –≥—É–±</b> üëÑ ‚Äì –≤—ã—Ç—è–≥–∏–≤–∞–π—Ç–µ –≥—É–±—ã –≤ —Ç—Ä—É–±–æ—á–∫—É, –∑–∞—Ç–µ–º —É–ª—ã–±–∞–π—Ç–µ—Å—å.\n\n"
            "5Ô∏è‚É£ <b>–†–∞–∑–º–∏–Ω–∫–∞ —è–∑—ã–∫–∞</b> üëÖ ‚Äì –¥–µ–ª–∞–π—Ç–µ –∫—Ä—É–≥–∏ —è–∑—ã–∫–æ–º –≤–Ω—É—Ç—Ä–∏ —Ä—Ç–∞.\n\n"
            "6Ô∏è‚É£ <b>–ü—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ —à—ë–ø–æ—Ç–æ–º</b> ü§´ ‚Äì —á—ë—Ç–∫–æ –ø—Ä–æ–≥–æ–≤–∞—Ä–∏–≤–∞–π—Ç–µ —Ç–µ–∫—Å—Ç —à—ë–ø–æ—Ç–æ–º.\n\n"
            "7Ô∏è‚É£ <b>–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–µ–º–ø—ã</b> üèé ‚Äì —Å–Ω–∞—á–∞–ª–∞ –≥–æ–≤–æ—Ä–∏—Ç–µ –º–µ–¥–ª–µ–Ω–Ω–æ, –∑–∞—Ç–µ–º –±—ã—Å—Ç—Ä–æ.\n\n"
            "8Ô∏è‚É£ <b>–ò–º–∏—Ç–∞—Ü–∏—è —Ä–µ—á–∏</b> üéô ‚Äì –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞ –¥–∏–∫—Ç–æ—Ä–∞–º–∏ –∏–ª–∏ –∞–∫—Ç—ë—Ä–∞–º–∏.\n\n"
            "9Ô∏è‚É£ <b>–ß—ë—Ç–∫–∏–µ —Å–æ–≥–ª–∞—Å–Ω—ã–µ</b> üîä ‚Äì —É—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç–µ –∑–≤—É–∫–∏ '–ë', '–î', '–ö'.\n\n"
            "üîü <b>–ü–µ–Ω–∏–µ —Å –¥–∏–∫—Ü–∏–µ–π</b> üé§ ‚Äì –ø–æ–π—Ç–µ –ø–µ—Å–Ω—é, –¥–µ–ª–∞—è –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —á—ë—Ç–∫–æ—Å—Ç–∏ —Å–ª–æ–≤.\n"
        ),

        "week_4": (
            "üìå <b>–ù–µ–¥–µ–ª—è 4: –ò–Ω—Ç–æ–Ω–∞—Ü–∏—è –∏ —Ä–∏—Ç–º</b>\n\n"
            "1Ô∏è‚É£ <b>–õ–µ—Å—Ç–Ω–∏—Ü–∞</b> üé∂ ‚Äì –ø–æ–π—Ç–µ –Ω–æ—Ç—ã, –¥–≤–∏–≥–∞—è—Å—å –≤–≤–µ—Ä—Ö –∏ –≤–Ω–∏–∑.\n\n"
            "2Ô∏è‚É£ <b>–ì—Ä–æ–º–∫–æ-—Ç–∏—Ö–æ</b> üîä ‚Äì –ø–æ–π—Ç–µ –∑–≤—É–∫, —Å–Ω–∞—á–∞–ª–∞ —É—Å–∏–ª–∏–≤–∞—è, –ø–æ—Ç–æ–º –æ—Å–ª–∞–±–ª—è—è –≥—Ä–æ–º–∫–æ—Å—Ç—å.\n\n"
            "3Ô∏è‚É£ <b>–†–∏—Ç–º —Ö–ª–æ–ø–∫–∞–º–∏</b> üëè ‚Äì —Ö–ª–æ–ø–∞–π—Ç–µ —Ä–∏—Ç–º –∏ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –µ–≥–æ –≥–æ–ª–æ—Å–æ–º.\n\n"
            "4Ô∏è‚É£ <b>–ò–º–∏—Ç–∞—Ü–∏—è –º–µ–ª–æ–¥–∏–π</b> üéµ ‚Äì –Ω–∞–ø–µ–≤–∞–π—Ç–µ –º–µ–ª–æ–¥–∏–∏ –±–µ–∑ —Å–ª–æ–≤.\n\n"
            "5Ô∏è‚É£ <b>–ü–µ–Ω–∏–µ —Å —É–ª—ã–±–∫–æ–π</b> üòÉ ‚Äì –ø–æ–π—Ç–µ, —É–ª—ã–±–∞—è—Å—å, –º–µ–Ω—è—è —Ç–µ–º–±—Ä.\n\n"
            "6Ô∏è‚É£ <b>–ì–æ–ª–æ—Å–æ–≤–∞—è –≤–æ–ª–Ω–∞</b> üåä ‚Äì –ø–æ–π—Ç–µ –∑–≤—É–∫, –¥–µ–ª–∞—è –µ–≥–æ —Ç–æ –≥—Ä–æ–º—á–µ, —Ç–æ —Ç–∏—à–µ.\n\n"
            "7Ô∏è‚É£ <b>–ü–µ—Å–Ω—è –≤ —Ä–∞–∑–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏</b> üé≠ ‚Äì –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø–µ—Ç—å –ø–µ—Å–Ω—é –≤–µ—Å–µ–ª–æ, –≥—Ä—É—Å—Ç–Ω–æ, —É–¥–∏–≤–ª—ë–Ω–Ω–æ.\n\n"
            "8Ô∏è‚É£ <b>–®—ë–ø–æ—Ç + –≥–æ–ª–æ—Å</b> üó£ ‚Äì –Ω–∞—á–Ω–∏—Ç–µ —Ñ—Ä–∞–∑—É —à—ë–ø–æ—Ç–æ–º, –∑–∞—Ç–µ–º –ø–ª–∞–≤–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å.\n\n"
            "9Ô∏è‚É£ <b>–†–∞–∑–Ω—ã–µ —Ä–∏—Ç–º—ã</b> ü•Å ‚Äì –ø–æ–π—Ç–µ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –º–µ–ª–æ–¥–∏—é –≤ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏ –±—ã—Å—Ç—Ä–æ–º —Ç–µ–º–ø–µ.\n\n"
            "üîü <b>–î–∏–Ω–∞–º–∏–∫–∞ –≤ –ø–µ—Å–Ω–µ</b> üéº ‚Äì –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ—á–∫—É –ø–µ—Å–Ω–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø–µ—Ç—å –µ—ë —Å–Ω–∞—á–∞–ª–∞ –æ—á–µ–Ω—å —Ç–∏—Ö–æ, –∑–∞—Ç–µ–º –≥—Ä–æ–º–∫–æ.\n"
        ),
    }


    week_key = callback_query.data
    text = week_data.get(week_key, "–û—à–∏–±–∫–∞: –ù–µ–¥–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")


    await callback_query.message.edit_text(text, parse_mode="HTML", reply_markup=back_keyboard())

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É –Ω–µ–¥–µ–ª—å
@router.callback_query(lambda c: c.data == "back_to_weeks")
async def back_to_weeks(callback_query: CallbackQuery):
    await callback_query.message.edit_text(
        "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é:", 
        parse_mode="HTML",
        reply_markup=create_week_selection_keyboard()
    )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π"
@router.message(lambda message: message.text == "–°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π")
async def handle_exercises_list(message: types.Message):
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:", reply_markup=create_categories_keyboard())

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
@router.callback_query(lambda c: c.data.startswith('category_'))
async def handle_category_selection(callback_query: CallbackQuery):
    # –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    category_map = {
        'category_breath': 'breath',
        'category_vocal': 'vocal',
        'category_articulation': 'articulation',
        'category_pitch': 'pitch',
        'category_resonance': 'resonance',
        'category_registers': 'registers',
        'category_rhythm': 'rhythm',
        'category_dynamics': 'dynamics',
        'category_accuracy': 'accuracy'
    }

    # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    category_names = {
        'breath': '–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è',
        'vocal': '–†–∞–∑–æ–≥—Ä–µ–≤ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–≤—è–∑–æ–∫',
        'articulation': '–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏—è –∏ –¥–∏–∫—Ü–∏—è',
        'pitch': '–ò–Ω—Ç–æ–Ω–∞—Ü–∏—è',
        'resonance': '–†–µ–∑–æ–Ω–∞–Ω—Å',
        'registers': '–í–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã',
        'rhythm': '–†–∏—Ç–º',
        'dynamics': '–î–∏–Ω–∞–º–∏–∫–∞',
        'accuracy': '–¢–æ—á–Ω–æ—Å—Ç—å –∏–Ω—Ç–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è'
    }

    category = category_map.get(callback_query.data)
    
    if category:
        try:
            # –õ–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            print(f"–ó–∞–ø—Ä–æ—Å –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category}")

            # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            keyboard = await create_exercises_keyboard(category)

            # –ü–æ–ª—É—á–∞–µ–º —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            category_display_name = category_names.get(category, category)

            await callback_query.message.edit_text(
                #f"–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category.replace('_', ' ').title()}",
                f"–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category_display_name}",
                reply_markup=keyboard
            )
        except sqlite3.Error as e:
            print(f"–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
            await callback_query.message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.")
        except Exception as e:
            print(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
            await callback_query.message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.")
    else:
        await callback_query.message.answer("–ù–µ–≤–µ—Ä–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è.")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
@router.callback_query(lambda c: c.data == 'back_to_categories')
async def back_to_categories(callback_query: CallbackQuery):
    try:
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        keyboard = create_categories_keyboard()
        await callback_query.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:", reply_markup=keyboard)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
        await callback_query.message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.")


CHANNEL_ID = -1002611999941  # ID –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞

TECH_CHANNEL_ID = -1002528783467  # ID —Å–∫—Ä—ã—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞

@router.callback_query(lambda c: c.data.startswith('exercise_'))
async def handle_exercise_selection(callback_query: CallbackQuery):
    bot = callback_query.bot
    exercise_id = callback_query.data.split('_')[1]
    category = callback_query.data.split('_')[2]

    try:
        conn = sqlite3.connect('v_exercises.db')
        cursor = conn.cursor()

        # –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç —Å –≤–∏–¥–µ–æ
        cursor.execute(f"SELECT exercise_link FROM {category} WHERE id=?", (exercise_id,))
        exercise = cursor.fetchone()
        conn.close()

        if exercise:
            link = exercise[0]

            # –ò–∑–≤–ª–µ–∫–∞–µ–º message_id –∏–∑ —Å—Å—ã–ª–∫–∏
            match = re.search(r'/(\d+)$', link)
            if match:
                message_id = int(match.group(1))

                # –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª
                forwarded_message = await bot.forward_message(
                    chat_id=TECH_CHANNEL_ID, 
                    from_chat_id=CHANNEL_ID, 
                    message_id=message_id
                )

                # –ü–æ–ª—É—á–∞–µ–º file_id –≤–∏–¥–µ–æ
                file_id = forwarded_message.video.file_id  

                # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —Å–∫—Ä—ã—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –µ–≥–æ
                await bot.delete_message(chat_id=TECH_CHANNEL_ID, message_id=forwarded_message.message_id)

                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞–ø—Ä—è–º—É—é
                await bot.send_video(chat_id=callback_query.message.chat.id, video=file_id)

            else:
                await callback_query.message.answer(f"–í–æ—Ç –≤–∞—à–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: {hlink('–°—Å—ã–ª–∫–∞ –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', link)}", parse_mode="HTML")

        else:
            await callback_query.message.answer("–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")

    except sqlite3.Error as e:
        await callback_query.message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.")
        print(f"–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
    except Exception as e:
        await callback_query.message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.")
        print(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")

